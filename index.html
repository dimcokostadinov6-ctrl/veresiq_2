<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<title>Veresia</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;background:#0a0f14;color:#f8fafc;font-family:system-ui}
.topbar{display:flex;align-items:center;gap:.5rem;background:#111827;padding:.5rem 1rem}
.btn{background:#1e3a8a;color:white;border:none;border-radius:.4rem;padding:.4rem .8rem;cursor:pointer}
#board{width:100%;height:90vh;display:block;background:repeating-linear-gradient(to bottom,#0a0f14 0,#0a0f14 28px,#1e293b 28px,#1e293b 29px)}
.toast{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);background:#111827;padding:.6rem .8rem;border-radius:.6rem;display:none}
.toast.show{display:block}
</style>
</head>
<body>
<div class="topbar">
  <button id="saveBtn" class="btn">üíæ –ó–∞–ø–∞–∑–∏</button>
  <span>‚úçÔ∏è –°–∞–º–æ –∫–∏—Ä–∏–ª–∏—Ü–∞</span>
</div>
<canvas id="board"></canvas>
<div id="toast" class="toast"></div>
<script>
const OCR_URL = "https://ocr-980985905017.europe-west1.run.app/ocr";
const canvas=document.getElementById("board"),ctx=canvas.getContext("2d",{willReadFrequently:true});
function resize(){const dpr=window.devicePixelRatio||1;const r=canvas.getBoundingClientRect();canvas.width=r.width*dpr;canvas.height=r.height*dpr;ctx.setTransform(dpr,0,0,dpr,0,0);ctx.strokeStyle="#f8fafc";ctx.lineCap="round";ctx.lineJoin="round";ctx.lineWidth=3;}
resize();window.addEventListener("resize",resize);
let drawing=false,last=null;
canvas.addEventListener("pointerdown",e=>{if(e.pointerType!=="pen")return;drawing=true;last={x:e.offsetX,y:e.offsetY}});
canvas.addEventListener("pointermove",e=>{if(!drawing||e.pointerType!=="pen")return;ctx.beginPath();ctx.moveTo(last.x,last.y);ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();last={x:e.offsetX,y:e.offsetY}});
canvas.addEventListener("pointerup",()=>drawing=false);
canvas.addEventListener("pointerleave",()=>drawing=false);

function toast(m){const el=document.getElementById("toast");el.textContent=m;el.classList.add("show");clearTimeout(el._t);el._t=setTimeout(()=>el.classList.remove("show"),2500);}

document.getElementById("saveBtn").onclick=()=>{
  canvas.toBlob(async blob=>{
    const reader=new FileReader();
    reader.onload=async()=>{
      try{
        toast("‚è≥ –†–∞–∑—á–∏—Ç–∞–Ω–µ...");
        const r=await fetch(OCR_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageBase64:reader.result})});
        const d=await r.json();
        if(!d.ok)throw new Error(d.error);
        toast("‚úÖ –†–∞–∑—á–µ—Ç–µ–Ω–∏ "+d.entries.length+" —Ä–µ–¥–∞");
        ctx.clearRect(0,0,canvas.width,canvas.height);
        console.log("OCR —Ä–µ–∑—É–ª—Ç–∞—Ç–∏:",d.entries);
      }catch(err){console.error(err);toast("‚ùå –ì—Ä–µ—à–∫–∞ OCR");}
    };
    reader.readAsDataURL(blob);
  });
};
</script>
</body>
</html>
